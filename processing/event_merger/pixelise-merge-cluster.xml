<marlin>

  <!-- The lcgeo directory where to look for the ILD model -->
 <constants>
 </constants>
  <!--########  Execute  ######################################## -->
  <execute>
    <!--processor name="InitDD4hep"/-->
    <processor name="MyMergeEvents"/>
    <processor name="MyPixelizationProcessor"/>
    <processor name="MySimCalo2CaloHit"/>
    <processor name="MyNNClustering"/>
    <processor name="MyMarlinArbor"/>
    <processor name="MyBushConnect"/>
   
    <processor name="MyTwoPhotonReco_strategy1"/>
    <processor name="MyTwoPhotonReco_strategy2"/>
    <processor name="MyTwoPhotonReco_strategy3"/>
    <processor name="MyTwoPhotonReco_strategy4"/>
    <processor name="MyTwoPhotonReco_recluster_strategy1"/>
    <processor name="MyTwoPhotonReco_recluster_strategy2"/>
    <processor name="MyTwoPhotonReco_recluster_strategy3"/>
    <processor name="MyTwoPhotonReco_recluster_strategy4"/>

    <processor name="DSTOutput"/>
  </execute>

  <!--########  Global  ######################################## -->
  <global>
    <parameter name="LCIOInputFiles">
      ../data/ECALe_luxe_v0_QGSP_BERT_e-_xENERGYMeV_1.slcio
    </parameter>
    <!--parameter name="AllowToModifyEvent" value="true" /-->  
    <!--parameter name="MaxRecordNumber" value="10"/-->  
    <parameter name="SkipNEvents" value="0"/>
    <parameter name="SupressCheck" value="false"/>
    <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> ERROR </parameter>
    <parameter name="RandomSeed" value="1234567890" />
  </global>


  <processor name="MyMergeEvents" type="MergeEvents">
    <parameter name="InputFileNames" type="StringVec"> ../data/ECALe_luxe_v0_QGSP_BERT_e-_xENERGYMeV_2.slcio </parameter>
    <parameter name="NumberMergeEvents" type="int"> 1 </parameter>
    <parameter name="CollectionMap" type ="StringVec"> MCParticle MCParticle SiEcalCollection SiEcalCollection </parameter>
    <!--parameter name="OutputFileName" type="string">  ./ECALe_luxe_v1_QGSP_BERT_e-_9500MeV_01.slcio </parameter-->
  </processor>

  <processor name="MyPixelizationProcessor" type="PixelizationProcessor">  
    <parameter name="SimECALCollectionName" type="string"> SiEcalCollection </parameter>
    <parameter name="PixelECALCollectionName" type="string"> PixelSiEcalCollection </parameter>

  </processor>

  <processor name="MySimCalo2CaloHit" type="SimCalo2CaloHit">  
    <parameter name="PixelECALCollectionName" type="string"> PixelSiEcalCollection </parameter>
    <parameter name="ECALCollectionName" type="string"> EcalCollection </parameter>
    <parameter name="GeV2MIPfactor" type="FloatVec"> 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 0.000146 </parameter>
    <parameter name="ADC_Signal_over_Noise" type="float"> 10. </parameter>
    <parameter name="TRIG_Signal_over_Noise" type="float"> 5. </parameter>
    <parameter name="MIP_threshold" type="float"> 0.5 </parameter>
    <parameter name="DoDigitization" type="bool"> true </parameter>
  </processor>


  <processor name="MyNNClustering" type="NNClusteringProcessor">  
    <parameter name="EcalCollection" type="StringVec"> EcalCollection </parameter>
    <parameter name="OutputCollection" type="string"> NNClusters </parameter>
    <parameter name="DistanceCut" type="float"> 20 </parameter><!--distance cut in mm-->
    <parameter name="EnergyCut" type="float"> 0. </parameter><!--energy cut in GeV-->
  </processor>

  <!-- ========== Initial clustering: from caloHit to branches ========= -->
  <processor name="MyMarlinArbor" type="MarlinArbor">
    <!--Hit Collection Names-->
    <!-- <parameter name="EcalHitCollections" type="StringVec" lcioInType="CalorimeterHit">ECALBarrel ECALEndcap ECALOther LCAL LHCAL </parameter> -->
    <parameter name="EcalHitCollections" type="StringVec" lcioInType="CalorimeterHit"> EcalCollection </parameter>
    <parameter name="HcalHitCollections" type="StringVec" lcioInType="CalorimeterHit">  </parameter>
        <!--Distance Threshold of Creating initial Arbor links-->
        <!--parameter name="ThresholdsforArborBuilding" type="FloatVec">20 90 50 11 </parameter-->
        <!--parameter name="HLayerCut" type="float">1293 </parameter-->
        <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
        <parameter name="Verbosity" type="string">SILENT </parameter>
  </processor>
  
    <!-- ========== Further clustering: from branches to clusters & track-cluster matching ========= -->
    <processor name="MyBushConnect" type="BushConnect">
      <!--Track Cluster Linking. Track info represented by MCTruth at this moment-->
      <parameter name="FlagDiagnosis" type="int">1 </parameter>
      <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
      <parameter name="Verbosity" type="string">SILENT </parameter>
    </processor>

  <processor name="MyTwoPhotonReco_strategy1" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_strategy1</parameter>
    <parameter name="DoReclustering" type="bool"> false </parameter>
    <parameter name="Strategy" type="int"> 1 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_strategy1" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_strategy1</parameter>
    <parameter name="DoReclustering" type="bool"> false </parameter>
    <parameter name="Strategy" type="int"> 1 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_strategy2" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_strategy2</parameter>
    <parameter name="DoReclustering" type="bool"> false </parameter>
    <parameter name="Strategy" type="int"> 2 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_strategy3" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_strategy3</parameter>
    <parameter name="DoReclustering" type="bool"> false </parameter>
    <parameter name="Strategy" type="int"> 3 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_strategy4" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_strategy4</parameter>
    <parameter name="DoReclustering" type="bool"> false </parameter>
    <parameter name="Strategy" type="int"> 4 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_recluster_strategy1" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_recluster_strategy1</parameter>
    <parameter name="DoReclustering" type="bool"> true </parameter>
    <parameter name="Strategy" type="int"> 1 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_recluster_strategy2" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_recluster_strategy2</parameter>
    <parameter name="DoReclustering" type="bool"> true  </parameter>
    <parameter name="Strategy" type="int"> 2 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_recluster_strategy3" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_recluster_strategy3</parameter>
    <parameter name="DoReclustering" type="bool"> true </parameter>
    <parameter name="Strategy" type="int"> 3 </parameter>  
  </processor>

 <processor name="MyTwoPhotonReco_recluster_strategy4" type="TwoPhotonClustering">
    <parameter name="CaloHitInputCollection" type="string"> EcalCollection </parameter>
    <parameter name="NNClusterInputCollection" type="string"> NNClusters </parameter> 
    <parameter name="OutputCollection" type="string"> TwoPhotonClusters_recluster_strategy4</parameter>
    <parameter name="DoReclustering" type="bool"> true </parameter>
    <parameter name="Strategy" type="int"> 4 </parameter>  
  </processor>

  <processor name="DSTOutput" type="LCIOOutputProcessor">
    <!--DST output: drop all hits, skim MCParticles and keep final Tracks, Clusters and  ReconstructedParticles-->
    <parameter name="LCIOOutputFile" type="string" > data/PixelDigiCluster_ECALe_luxe_v1_QGSP_BERT_e-_xENERGYMeV_merged_events.slcio </parameter>
    <parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
    <!--parameter name="SplitFileSizekB" type="int" value="1992294"/-->
  </processor>


</marlin>
